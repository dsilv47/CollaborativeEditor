<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UI</title>
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
</head>
<body>
    <label for="docid">Document ID:</label><br>
    <input type="text" id="docid" name="docid"><br>
    <input type="button" value="Open" onclick="openDoc()">
    <div id="editor">

    </div>
    <input type="button" value="POSTREQTEST" onclick="postReq()">

    <script>
        var quill = new Quill('#editor', {
            theme: 'snow'
        });

        function openDoc() {
            //let ydoc = new Y.Doc();
            //let ytext = ydoc.getText('doc-contents');
            //const binding = new QuillBinding(ytext, quill);
            let url = "/api/connect/" + document.getElementById("docid").value;
            const source = new EventSource(url);
            source.addEventListener('sync', event => {
                console.log("SYNC");
                console.log(event.data);
            });
            source.addEventListener('update', event => {
                console.log("UPDATE");
                console.log(event.data);
            });
        }

        function postReq() {
            var http = new XMLHttpRequest();
            var url = '/api/op/' + document.getElementById("docid").value;
            http.open('POST', url, true);
            http.setRequestHeader('Content-Type', 'application/json');

            http.onreadystatechange = function() {//Call a function when the state changes.
                console.log(http.responseText);
            }

            let update = [{ "insert": "Hello" }];

            http.send(update);
        }
    </script>
</body>
</html>